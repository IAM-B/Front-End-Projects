<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"
    />
    <title>Al-Fatiha</title>
  </head>
  <body>
    <style>
      body {
        font-family: Arial, sans-serif;
        background-color: #f5f5f5;
        padding: 20px;
      }

      .hidden {
        display: none;
      }

      .verse-number {
        display: inline-block;
        width: 30px;
        font-weight: bold;
      }

      .arabic {
        font-family: "Arial Unicode MS", "Scheherazade", serif;
        font-size: 30px;
      }

      .translation {
        display: block;
        font-size: 20px;
        color: #555;
      }

      .basmala {
        text-align: center;
        font-size: 32px;
        margin: 30px 0 50px 0;
      }

      .sura {
        text-align: center;
        font-size: 26px;
        margin-top: 40px;
      }

      .ayah {
        text-align: center;
        font-size: 24px;
        margin-bottom: 10px;
      }

      .verse-input {
        direction: rtl;
        text-align: right;
        border: none;
        border-bottom: 1px solid #000;
        background-color: transparent;
      }

      input:focus {
        outline: none;
      }

      i.fas.fa-trash {
        color: black;
      }

      .keyboard {
        position: fixed;
        bottom: 0;
        left: 0;
        width: 100%;
        background-color: #f5f5f5;
        border: 1px solid #ccc;
        padding: 2%;
        border-radius: 5px;
        transform: translateY(100%);
        transition: transform 0.3s ease-out;
        z-index: 9999;
      }

      .keyboard.show {
        transform: translateY(0);
      }

      .keyboard-row {
        display: flex;
        justify-content: center;
        align-items: center;
        margin-bottom: 1%;
        flex-wrap: wrap;
      }

      .keyboard-key {
        display: flex;
        width: 10%;
        height: 10vh;
        padding: 1%;
        font-size: 3vh;
        font-weight: 400;
        background-color: #fff;
        border: 1px solid #ccc;
        border-radius: 5px;
        margin: 0 1%;
        justify-content: center;
        align-items: center;
        cursor: pointer;
      }

      .keyboard-key:hover {
        background-color: #e0e0e0;
      }

      .keyboard-key:active {
        background-color: #ccc;
      }

      .keyboard-key.direction {
        display: flex;
        width: 11%;
        margin: 0 1px;
        justify-content: center;
        align-items: center;
      }

      .keyboard-key.space {
        margin-left: auto;
      }

      @media (max-width: 767px) {
        .keyboard-key {
          width: 7%;
          height: 5vh;
          font-size: 2.5vh;
        }

        .keyboard-key.space {
          width: 35%;
          margin-right: 10%;
        }
      }

      @media (min-width: 768px) and (max-width: 991px) {
        .keyboard-key {
          width: 7%;
          height: 6vh;
          font-size: 3vh;
        }

        .keyboard-key.space {
          width: 40%;
          margin-right: 7%;
        }
      }

      @media (min-width: 992px) {
        .keyboard-key {
          width: 5%;
          height: 7vh;
          font-size: 3vh;
        }

        .keyboard-key.space {
          width: 45%;
          margin-right: 5%;
        }
      }
    </style>

    <div class="sura">سورة الفاتحة</div>
    <div class="basmala"></div>

    <div id="table"></div>

    <button id="editButton">Exercice</button>
    <button id="checkButton">Correction</button>

    <!--TEMPLATE-->
    <script>
      // Données de la sourate Al-Fatiha
      const data = [
        {
          verseNumber: "١",
          arabicText: "بِسْمِ اللَّهِ الرَّحْمَٰنِ الرَّحِيمِ",
          translationText: "",
        },
        {
          verseNumber: "٢",
          arabicText: "الْحَمْدُ لِلَّهِ رَبِّ الْعَالَمِينَ",
          translationText: "",
        },
        {
          verseNumber: "٣",
          arabicText: "الرَّحْمَٰنِ الرَّحِيمِ",
          translationText: "",
        },
      ];

      // Fonction pour créer dynamiquement les éléments HTML et les ajouter au tableau
      const populateTable = () => {
        const table = document.getElementById("table");

        data.forEach((verse) => {
          const verseDiv = document.createElement("div");
          verseDiv.className = "ayah";

          const verseNumberSpan = document.createElement("span");
          verseNumberSpan.className = "verse-number";
          verseNumberSpan.textContent = verse.verseNumber;

          const arabicTextSpan = document.createElement("span");
          arabicTextSpan.className = "arabic";
          arabicTextSpan.textContent = verse.arabicText;

          const translationSpan = document.createElement("span");
          translationSpan.className = "translation";
          translationSpan.textContent = verse.translationText;

          verseDiv.appendChild(verseNumberSpan);
          verseDiv.appendChild(arabicTextSpan);
          verseDiv.appendChild(translationSpan);

          table.appendChild(verseDiv);
        });
      };

      populateTable();

      // Fonction pour masquer le texte et afficher les zones de texte
      const hideTextAndShowInput = () => {
        const ayahs = document.getElementsByClassName("ayah");
        for (let i = 0; i < ayahs.length; i++) {
          const ayah = ayahs[i];
          const verseText = ayah.querySelector(".arabic");
          const verseInput = document.createElement("input");
          verseInput.type = "search";
          verseInput.classList.add("verse-input");
          verseInput.placeholder = "Réécrivez le verset...";
          verseInput.autocomplete = "off";
          verseInput.setAttribute("inputmode", "none");
          verseInput.size = verseText.textContent.length;
          ayah.replaceChild(verseInput, verseText);
        }
      };

      document
        .getElementById("editButton")
        .addEventListener("click", hideTextAndShowInput);

      // Fonction pour corriger les réponses des utilisateurs
      const checkAnswers = () => {
        const inputs = document.getElementsByClassName("verse-input");

        for (let i = 0; i < inputs.length; i++) {
          const input = inputs[i];
          const userAnswer = input.value.trim();
          const verse = data[i];

          // Comparaison de la réponse utilisateur avec le verset correspondant
          if (userAnswer === verse.arabicText) {
            input.classList.add("correct");
            input.classList.remove("incorrect");
          } else {
            input.classList.add("incorrect");
            input.classList.remove("correct");
          }
        }
      };

      // Écouteur d'événement pour le bouton "Vérifier les réponses"
      document
        .getElementById("checkButton")
        .addEventListener("click", checkAnswers);
    </script>
    <!--KEYBOARD-->
    <script>
      const generateVirtualKeyboard = () => {
        const keyboardContainer = document.createElement("div");
        keyboardContainer.classList.add("keyboard");

        const keyboardRows = [
          ["ّ", "َ", "ً", "ُ", "ٌ", "ِ", "ٍ", "ْ", "ٰ", "ۡ"],
          ["ض", "ص", "ث", "ق", "ف", "غ", "ع", "ه", "خ", "ح", "ج"],
          ["ش", "س", "ي", "ب", "ل", "ا", "ت", "ن", "م", "ك"],
          ["ء", "ؤ", "ر", "لا", "ى", "ة", "و", "ز", "ظ"],
          ["ا", "أ", "إ", "آ", "ئ", "ؤ", "ء"],
        ];

        keyboardRows.forEach((row) => {
          const keyboardRow = document.createElement("div");
          keyboardRow.classList.add("keyboard-row");

          row.forEach((key) => {
            const button = document.createElement("button");
            button.classList.add("keyboard-key");
            button.textContent = key;

            keyboardRow.appendChild(button);
          });

          keyboardContainer.appendChild(keyboardRow);
        });

        // Ajout de la barre d'espace et du bouton de suppression des caractères
        const spaceDeleteRow = document.createElement("div");
        spaceDeleteRow.classList.add("keyboard-row");

        const deleteButton = document.createElement("button");
        deleteButton.classList.add("keyboard-key", "delete");
        deleteButton.innerHTML =
          "<span class='delete-icon'><i class='fas fa-chevron-right'></i></span>";
        deleteButton.addEventListener("click", () => {
          const selectedInput = document.querySelector(".verse-input.selected");
          if (selectedInput) {
            const currentValue = selectedInput.value;
            const currentCursorPosition = selectedInput.selectionStart;
            const textBeforeCursor = currentValue.substring(
              0,
              currentCursorPosition - 1
            );
            const textAfterCursor = currentValue.substring(
              currentCursorPosition
            );
            selectedInput.value = textBeforeCursor + textAfterCursor;
            selectedInput.selectionStart = currentCursorPosition - 1;
            selectedInput.selectionEnd = currentCursorPosition - 1;
          }
        });

        spaceDeleteRow.appendChild(deleteButton);

        const spaceButton = document.createElement("button");
        spaceButton.classList.add("keyboard-key", "space");
        spaceButton.textContent = " ";
        spaceDeleteRow.appendChild(spaceButton);

        const leftButton = document.createElement("button");
        leftButton.classList.add("keyboard-key", "direction");
        leftButton.innerHTML = "<i class='fas fa-arrow-left'></i>";
        leftButton.addEventListener("click", () => {
          const selectedInput = document.querySelector(".verse-input.selected");
          if (selectedInput) {
            const currentCursorPosition = selectedInput.selectionStart;
            if (currentCursorPosition < selectedInput.value.length) {
              selectedInput.selectionStart = currentCursorPosition + 1;
              selectedInput.selectionEnd = currentCursorPosition + 1;
            }
          }
        });
        spaceDeleteRow.appendChild(leftButton);

        const rightButton = document.createElement("button");
        rightButton.classList.add("keyboard-key", "direction");
        rightButton.innerHTML = "<i class='fas fa-arrow-right'></i>";
        rightButton.addEventListener("click", () => {
          const selectedInput = document.querySelector(".verse-input.selected");
          if (selectedInput) {
            const currentCursorPosition = selectedInput.selectionStart;
            if (currentCursorPosition > 0) {
              selectedInput.selectionStart = currentCursorPosition - 1;
              selectedInput.selectionEnd = currentCursorPosition - 1;
            }
          }
        });
        spaceDeleteRow.appendChild(rightButton);

        keyboardContainer.appendChild(spaceDeleteRow);

        document.body.appendChild(keyboardContainer);
      };

      const attachKeyboardEvents = (input) => {
        const keyboardKeys = document.querySelectorAll(".keyboard-key");
        const keyboard = document.querySelector(".keyboard");

        keyboardKeys.forEach((key) => {
          key.addEventListener("click", () => {
            const character = key.textContent;

            const selectedInput = document.querySelector(
              ".verse-input.selected"
            );

            if (input === selectedInput) {
              selectedInput.value += character;
            }
          });

          key.addEventListener("mousedown", (event) => {
            event.preventDefault();
          });
        });

        input.addEventListener("click", () => {
          const inputFields = document.querySelectorAll(".verse-input");
          inputFields.forEach((i) => i.classList.remove("selected"));
          input.classList.add("selected");
        });

        input.addEventListener("focus", () => {
          keyboard.classList.add("show");
          const inputLength = input.value.length;
          input.setSelectionRange(inputLength, inputLength); // Positionne le curseur à la fin du texte
        });

        input.addEventListener("blur", () => {
          keyboard.classList.remove("show");
        });

        input.addEventListener("keydown", (event) => {
          if (event.key === "ArrowLeft" || event.key === "ArrowRight") {
            event.preventDefault(); // Empêche la navigation par défaut des flèches gauche et droite
          }
        });
      };

      const observer = new MutationObserver((mutationsList) => {
        mutationsList.forEach((mutation) => {
          if (mutation.addedNodes.length > 0) {
            mutation.addedNodes.forEach((node) => {
              if (
                node.tagName === "INPUT" &&
                node.classList.contains("verse-input")
              ) {
                attachKeyboardEvents(node);
              }
            });
          }
        });
      });

      const config = {
        childList: true,
        subtree: true,
      };

      observer.observe(document, config);

      generateVirtualKeyboard();
    </script>
  </body>
</html>
